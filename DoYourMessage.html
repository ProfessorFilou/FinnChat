<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Finns Chat</title>
<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/733/733585.png" type="image/png">
<style>
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
body {
  font-family: 'Montserrat', sans-serif;
  margin: 0;
  background: linear-gradient(135deg, #f3ece1, #e0d4c3);
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100vh;
}
.container {
  background: #d9c4a9;
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 12px 30px rgba(0,0,0,0.25);
  width: 100%;
  max-width: 450px;
  text-align: center;
}
input, button {
  padding: 12px;
  margin: 8px 0;
  width: 100%;
  border-radius: 10px;
  border: none;
  font-size: 1em;
}
button {
  background: #8b5e3c;
  color: white;
  cursor: pointer;
  transition: 0.3s;
}
button:hover {
  background: #5e3a21;
}
#messages {
  background: rgba(255,255,255,0.6);
  height: 250px;
  overflow-y: auto;
  border-radius: 12px;
  padding: 10px;
  text-align: left;
  box-shadow: inset 0 0 10px rgba(0,0,0,0.1);
}
.msg {
  margin: 8px 0;
  background: #a67857;
  color: white;
  display: inline-block;
  padding: 8px 12px;
  border-radius: 10px;
}
.you { background: #2ecc71; }
</style>
</head>
<body>
<div class="container">
  <h2>ðŸ’¬ Finns Chat</h2>
  <div id="loginBox">
    <input id="email" type="email" placeholder="E-Mail">
    <input id="password" type="password" placeholder="Passwort">
    <button id="registerBtn">Registrieren</button>
    <button id="loginBtn">Anmelden</button>
  </div>

  <div id="chatBox" style="display:none;">
    <div id="messages"></div>
    <input id="msgInput" placeholder="Nachricht...">
    <button id="sendBtn">Senden</button>
    <button id="logoutBtn">Abmelden</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { 
    getAuth, createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, onAuthStateChanged, signOut 
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { 
    getDatabase, ref, push, onChildAdded 
  } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  // Deine Firebase Config:
  const firebaseConfig = {
    apiKey: "AIzaSyBzRqLM-XE1KwfJ7jH7hlIt0k3DlIukzPU",
    authDomain: "finn-s-nachrichten.firebaseapp.com",
    databaseURL: "https://finn-s-nachrichten-default-rtdb.firebaseio.com",
    projectId: "finn-s-nachrichten",
    storageBucket: "finn-s-nachrichten.firebasestorage.app",
    messagingSenderId: "1091909300157",
    appId: "1:1091909300157:web:165da9294f1b0c2d152cd4"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getDatabase(app);

  const loginBox = document.getElementById("loginBox");
  const chatBox = document.getElementById("chatBox");
  const messages = document.getElementById("messages");
  const msgInput = document.getElementById("msgInput");

  document.getElementById("registerBtn").addEventListener("click", () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    createUserWithEmailAndPassword(auth, email, password)
      .then(() => alert("Konto erstellt!"))
      .catch(err => alert(err.message));
  });

  document.getElementById("loginBtn").addEventListener("click", () => {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;
    signInWithEmailAndPassword(auth, email, password)
      .catch(err => alert(err.message));
  });

  document.getElementById("logoutBtn").addEventListener("click", () => {
    signOut(auth);
  });

  onAuthStateChanged(auth, user => {
    if (user) {
      loginBox.style.display = "none";
      chatBox.style.display = "block";
      loadMessages(user);
    } else {
      chatBox.style.display = "none";
      loginBox.style.display = "block";
      messages.innerHTML = "";
    }
  });

  function loadMessages(user) {
    const chatRef = ref(db, "chats/global");
    document.getElementById("sendBtn").onclick = () => {
      const text = msgInput.value.trim();
      if (!text) return;
      push(chatRef, {
        uid: user.uid,
        email: user.email,
        message: text,
        time: new Date().toLocaleTimeString()
      });
      msgInput.value = "";
    };

    onChildAdded(chatRef, (data) => {
      const msg = data.val();
      const div = document.createElement("div");
      div.classList.add("msg");
      if (msg.uid === user.uid) div.classList.add("you");
      div.textContent = `${msg.email.split("@")[0]}: ${msg.message}`;
      messages.appendChild(div);
      messages.scrollTop = messages.scrollHeight;
    });
  }
</script>
</body>
</html>
